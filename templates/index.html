<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project Samarth Q&A</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body { padding: 2rem; }
        .card { margin-bottom: 1rem; }
        .spinner { display: none; }
    </style>
</head>
<body>
    <h1 class="mb-4">Project Samarth Q&A</h1>

    <form id="questionForm">
        <div class="mb-3">
            <label for="questionType" class="form-label">Question Type</label>
            <select id="questionType" class="form-select" required>
                <option value="">Select...</option>
                <option value="rainfall_compare">Compare Rainfall</option>
                <option value="top_crops">Top Crops</option>
                <option value="crop_trend">Crop Trend Analysis</option>
                <option value="policy_advice">Policy Advice</option>
            </select>
        </div>

        <div id="params"></div>

        <button type="submit" class="btn btn-primary">Ask</button>
        <div class="spinner" id="spinner">Loading...</div>
    </form>

    <hr>

    <div id="results"></div>

    <script>
        const paramsDiv = document.getElementById("params");
        const questionType = document.getElementById("questionType");
        const spinner = document.getElementById("spinner");
        const resultsDiv = document.getElementById("results");

        questionType.addEventListener("change", () => {
            const type = questionType.value;
            let html = '';
            if (type === "rainfall_compare") {
                html = `
                    <div class="mb-3">
                        <label>State X:</label>
                        <input type="text" id="stateX" class="form-control" value="Punjab" required>
                    </div>
                    <div class="mb-3">
                        <label>State Y:</label>
                        <input type="text" id="stateY" class="form-control" value="Haryana" required>
                    </div>
                `;
            } else if (type === "top_crops") {
                html = `
                    <div class="mb-3">
                        <label>State X:</label>
                        <input type="text" id="stateX" class="form-control" value="Punjab" required>
                    </div>
                    <div class="mb-3">
                        <label>State Y:</label>
                        <input type="text" id="stateY" class="form-control" value="Haryana" required>
                    </div>
                    <div class="mb-3">
                        <label>Top N:</label>
                        <input type="number" id="topN" class="form-control" value="3">
                    </div>
                `;
            } else if (type === "crop_trend") {
                html = `
                    <div class="mb-3">
                        <label>Crop:</label>
                        <input type="text" id="crop" class="form-control" value="Wheat" required>
                    </div>
                    <div class="mb-3">
                        <label>Region/State:</label>
                        <input type="text" id="region" class="form-control" value="Punjab" required>
                    </div>
                `;
            } else if (type === "policy_advice") {
                html = `
                    <div class="mb-3">
                        <label>Crop A:</label>
                        <input type="text" id="cropA" class="form-control" value="Wheat" required>
                    </div>
                    <div class="mb-3">
                        <label>Crop B:</label>
                        <input type="text" id="cropB" class="form-control" value="Rice" required>
                    </div>
                    <div class="mb-3">
                        <label>State:</label>
                        <input type="text" id="state" class="form-control" value="Punjab" required>
                    </div>
                `;
            }
            paramsDiv.innerHTML = html;
        });

        document.getElementById("questionForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            spinner.style.display = "inline-block";
            resultsDiv.innerHTML = "";

            let payload = { type: questionType.value };
            if (payload.type === "rainfall_compare") {
                payload.stateX = document.getElementById("stateX").value;
                payload.stateY = document.getElementById("stateY").value;
            } else if (payload.type === "top_crops") {
                payload.stateX = document.getElementById("stateX").value;
                payload.stateY = document.getElementById("stateY").value;
                payload.topN = parseInt(document.getElementById("topN").value);
            } else if (payload.type === "crop_trend") {
                payload.crop = document.getElementById("crop").value;
                payload.region = document.getElementById("region").value;
            } else if (payload.type === "policy_advice") {
                payload.cropA = document.getElementById("cropA").value;
                payload.cropB = document.getElementById("cropB").value;
                payload.state = document.getElementById("state").value;
            }

            const response = await fetch("/ask_ui", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await response.json();
            spinner.style.display = "none";

            if (typeof data.answer === "object") {
                resultsDiv.innerHTML = "<pre>" + JSON.stringify(data.answer, null, 2) + "</pre>";
            } else {
                resultsDiv.innerHTML = `<p>${data.answer}</p>`;
            }
        });
    </script>
</body>
</html>
